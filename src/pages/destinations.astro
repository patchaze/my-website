---
import BaseLayout from '../layouts/BaseLayout.astro';
import CTABanner from '../components/CTABanner.astro';
import countriesData from '../data/countries.json';
import { Image } from 'astro:assets';

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/**/*.{jpeg,jpg,png,gif}');

// Group countries by region
const groupedCountries = countriesData.reduce((acc, country) => {
  if (!acc[country.region]) acc[country.region] = [];
  acc[country.region].push(country);
  return acc;
}, {});

// Desired order of regions
const regionOrder = [
  "Western Europe",
  "Southern Europe",
  "Northern Europe",
  "Central & Eastern Europe",
  "Microstates Associated via Open Borders",
  "Recently Added"
];
---

<BaseLayout
  title="Destinations | Travel with DURIAN"
  description="Explore the best Schengen and European destinations. We provide customized itineraries and visa guidance for your journey."
  breadcrumb={[{ name: 'Destinations', url: 'https://www.duriantravel.com/destinations/' }]}
>

  <section class="hero-sm hero-gradient">
    <div class="container text-center">
      <span class="section-label" style="color:var(--color-accent-light)">Destinations</span>
      <h1 class="hero-sm__title" style="color:white">Discover Europe in 2026</h1>
      <p style="color:rgba(255,255,255,0.8); max-width: 600px; margin: 0 auto; padding-top:1rem;">
        Click on any country to explore its top cities, visa specifics, and practical facts.
      </p>
    </div>
  </section>

  <section class="section section--alt">
    <div class="container">
      {regionOrder.map(region => {
        const countries = groupedCountries[region];
        if (!countries) return null;
        
        return (
          <div class="region-group mb-16">
            <h2 class="region-title">{region}</h2>
            <div class="destinations-grid">
              {countries.map(country => (
                <a href={`/destinations/${country.slug}/`} class="destination-tile" aria-label={`Explore ${country.name}`}>
                  <div class="tile-image-wrapper">
                    <Image src={images[`/src/assets${country.heroImage}`]()} alt={country.name} width={800} loading="lazy" />
                    <div class="tile-overlay">
                      <span class="explore-btn">Explore</span>
                    </div>
                  </div>
                  <div class="tile-content">
                    <h3 class="tile-name">{country.name}</h3>
                    <p class="tile-meta">{country.metaLine}</p>
                  </div>
                </a>
              ))}
            </div>
          </div>
        )
      })}
    </div>
  </section>

  <CTABanner
    title="Ready to choose your destination?"
    subtitle="Book a free 15-minute call. Tell us what you love â€” we'll craft the perfect itinerary."
    cta="Book Free Call"
  />

</BaseLayout>

<style>
.mb-16 {
  margin-bottom: var(--space-16);
}
.region-title {
  font-family: var(--font-serif);
  font-size: var(--text-2xl);
  color: var(--color-navy);
  margin-bottom: var(--space-8);
  padding-bottom: var(--space-3);
  border-bottom: 2px solid var(--color-accent);
  display: inline-block;
}

/* 4 columns desktop, 2 tablets, 1 mobile */
.destinations-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--space-6);
}

@media (max-width: 1024px) {
  .destinations-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 500px) {
  .destinations-grid {
    grid-template-columns: 1fr;
  }
}

.destination-tile {
  display: block;
  text-decoration: none;
  background: white;
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  transition: all var(--transition-normal);
}

.destination-tile:hover, 
.destination-tile:focus {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.1);
  outline: none;
}

.tile-image-wrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1; /* perfect square */
  overflow: hidden;
}

.tile-image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform var(--transition-slow);
}

.destination-tile:hover .tile-image-wrapper img,
.destination-tile:focus .tile-image-wrapper img {
  transform: scale(1.1);
}

.tile-overlay {
  position: absolute;
  inset: 0;
  background: rgba(15, 33, 56, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity var(--transition-normal);
}

.destination-tile:hover .tile-overlay,
.destination-tile:focus .tile-overlay {
  opacity: 1;
}

.explore-btn {
  background: var(--color-accent);
  color: white;
  padding: 10px 24px;
  border-radius: var(--radius-full);
  font-weight: var(--font-bold);
  font-size: var(--text-sm);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transform: translateY(10px);
  transition: transform var(--transition-normal);
}

.destination-tile:hover .explore-btn,
.destination-tile:focus .explore-btn {
  transform: translateY(0);
}

.tile-content {
  padding: var(--space-4);
  text-align: center;
}

.tile-name {
  font-size: var(--text-lg);
  font-weight: var(--font-bold);
  color: var(--color-navy);
  margin-bottom: var(--space-2);
}

.tile-meta {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}
</style>