---
export interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  ogType?: string;
  article?: {
    author: string;
    datePublished: string;
    dateModified: string;
    tags?: string[];
  };
  breadcrumb?: Array<{ name: string; url: string }>;
  schema?: object | object[];
  noindex?: boolean;
  hreflang?: Array<{ lang: string; url: string }>;
}

const {
  title,
  description,
  canonical,
  ogImage = 'https://duriantravel.com/og-default.png',
  ogType = 'website',
  article,
  breadcrumb,
  schema,
  noindex = false,
  hreflang = [],
} = Astro.props;

const canonicalURL = canonical ?? new URL(Astro.url.pathname, Astro.site).href;

// Build JSON-LD array
const schemas: object[] = [];

// Organization schema (on every page)
const orgSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "DURIAN",
  "url": "https://duriantravel.com",
  "logo": "https://duriantravel.com/favicon.svg",
  "description": "Educational visa document strategy and preparation guidance. Not a law firm. Not a visa agent.",
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "availableLanguage": ["English", "Spanish", "Portuguese", "French"]
  },
  "sameAs": []
};
schemas.push(orgSchema);

// WebSite schema on homepage
if (Astro.url.pathname === '/') {
  schemas.push({
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "DURIAN",
    "url": "https://duriantravel.com",
    "potentialAction": {
      "@type": "SearchAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "https://duriantravel.com/blog/?q={search_term_string}"
      },
      "query-input": "required name=search_term_string"
    }
  });
}

// Breadcrumb schema
if (breadcrumb && breadcrumb.length > 0) {
  schemas.push({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://duriantravel.com/"
      },
      ...breadcrumb.map((item, index) => ({
        "@type": "ListItem",
        "position": index + 2,
        "name": item.name,
        "item": item.url
      }))
    ]
  });
}

// Article schema
if (article) {
  schemas.push({
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": title,
    "description": description,
    "image": ogImage,
    "author": {
      "@type": "Person",
      "name": article.author,
      "url": "https://duriantravel.com/about/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "DURIAN",
      "url": "https://duriantravel.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://duriantravel.com/favicon.svg"
      }
    },
    "datePublished": article.datePublished,
    "dateModified": article.dateModified,
    "mainEntityOfPage": canonicalURL,
    "keywords": article.tags?.join(', ')
  });
}

// Extra schema passed from page
if (schema) {
  const extraSchemas = Array.isArray(schema) ? schema : [schema];
  schemas.push(...extraSchemas);
}
---

<!-- Primary Meta -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="generator" content={Astro.generator} />

<!-- SEO -->
<title>{title}</title>
<meta name="description" content={description} />
{noindex ? <meta name="robots" content="noindex, nofollow" /> : <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />}
<link rel="canonical" href={canonicalURL} />

<!-- Hreflang -->
{hreflang.map(h => (
  <link rel="alternate" hreflang={h.lang} href={h.url} />
))}
{hreflang.length > 0 && (
  <link rel="alternate" hreflang="x-default" href={canonicalURL} />
)}

<!-- Open Graph -->
<meta property="og:type" content={ogType} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:image" content={ogImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content="DURIAN" />
<meta property="og:locale" content="en_US" />
{article && <meta property="article:published_time" content={article.datePublished} />}
{article && <meta property="article:modified_time" content={article.dateModified} />}
{article && <meta property="article:author" content={article.author} />}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />
<meta name="twitter:site" content="@visareadyguide" />

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

<!-- Fonts: Preconnect + preload -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" />

<!-- JSON-LD Structured Data -->
{schemas.map(s => (
  <script type="application/ld+json" set:html={JSON.stringify(s)} />
))}
